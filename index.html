<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sky Rush: Advanced</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        :root {
            --primary: #4ec0ff;
            --accent: #ffd700;
            --danger: #ff4757;
            --dark: #2f3542;
            --light: #f1f2f6;
            --font-main: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: var(--dark);
            font-family: var(--font-main);
            color: var(--light);
            touch-action: none;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #1e90ff, #87cefa);
        }

        /* UI Overlays */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.75);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .hidden {
            opacity: 0;
            pointer-events: none;
            display: none !important;
        }

        h1 {
            font-size: 3.5rem;
            margin: 0 0 10px 0;
            text-transform: uppercase;
            letter-spacing: 5px;
            background: linear-gradient(to right, var(--accent), #ff9f43);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
        }

        p {
            font-size: 1.1rem;
            max-width: 600px;
            text-align: center;
            line-height: 1.5;
            color: #ddd;
            margin-bottom: 20px;
        }

        .btn {
            padding: 15px 40px;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--dark);
            background: var(--accent);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 10px;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            text-transform: uppercase;
        }

        .btn:hover {
            transform: translateY(-3px) scale(1.05);
            background: #ffeaa7;
        }

        /* HUD */
        #hud {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            pointer-events: none;
            z-index: 5;
            font-size: 1.5rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .stat-box {
            background: rgba(0,0,0,0.4);
            padding: 8px 15px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .powerup-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-block;
        }

        #active-powerups {
            position: absolute;
            top: 70px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .powerup-badge {
            background: rgba(0,0,0,0.5);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        @keyframes popIn {
            from { transform: scale(0); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* Bird Selection */
        .bird-selector {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .bird-card {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
            text-align: center;
            width: 90px;
        }

        .bird-card:hover, .bird-card.selected {
            background: rgba(255,255,255,0.2);
            border-color: var(--accent);
            transform: translateY(-5px);
        }

        .bird-preview {
            width: 50px;
            height: 50px;
            margin: 0 auto 5px;
            border-radius: 50%;
        }

        .legend {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            font-size: 0.9rem;
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 10px;
        }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .dot { width: 12px; height: 12px; border-radius: 50%; display: inline-block; }

    </style>
</head>
<body>

    <div id="game-container">
        <canvas id="gameCanvas"></canvas>

        <div id="hud">
            <div class="stat-box">SCORE: <span id="score-val">0</span></div>
            <div class="stat-box">SPEED: <span id="speed-val">0</span></div>
        </div>
        
        <div id="active-powerups"></div>

        <!-- Start Screen -->
        <div id="start-screen" class="overlay">
            <h1>Sky Rush v2</h1>
            <p>Dodge trees and moving drones.<br>Grab Shield & Magnet power-ups!</p>
            
            <div class="bird-selector">
                <div class="bird-card selected" onclick="selectBird('eagle')" id="card-eagle">
                    <div class="bird-preview" style="background: #8B4513;"></div>
                    <div>Eagle</div>
                </div>
                <div class="bird-card" onclick="selectBird('falcon')" id="card-falcon">
                    <div class="bird-preview" style="background: #4169e1;"></div>
                    <div>Falcon</div>
                </div>
                <div class="bird-card" onclick="selectBird('parrot')" id="card-parrot">
                    <div class="bird-preview" style="background: #ff4757;"></div>
                    <div>Parrot</div>
                </div>
            </div>

            <div class="legend">
                <div class="legend-item"><span class="dot" style="background:cyan; box-shadow: 0 0 5px cyan;"></span> Shield</div>
                <div class="legend-item"><span class="dot" style="background:#a29bfe; box-shadow: 0 0 5px #a29bfe;"></span> Magnet</div>
                <div class="legend-item"><span class="dot" style="background:#555;"></span> Drone</div>
            </div>

            <button class="btn" onclick="startGame()">Start Race</button>
            <p style="font-size: 0.8rem; margin-top:15px; opacity:0.7;">Arrows/Touch to Steer â€¢ Space to Boost</p>
        </div>

        <!-- Game Over Screen -->
        <div id="game-over-screen" class="overlay hidden">
            <h1 style="color: var(--danger);">CRASHED!</h1>
            <p>Final Score</p>
            <div id="final-score" style="font-size: 3rem; color: var(--accent); margin-bottom: 20px;">0</div>
            <button class="btn" onclick="resetGame()">Race Again</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let width, height;

        // Game State
        let isPlaying = false;
        let isGameOver = false;
        let score = 0;
        let lastTime = 0;
        
        // Audio
        let synth, noiseSynth, coinSynth, powerupSynth, crashSynth;
        let isAudioInit = false;

        // Configuration
        const birds = {
            eagle: { color: '#8B4513', secondary: '#DEB887', speed: 1.0, handling: 1.0 },
            falcon: { color: '#4169E1', secondary: '#E0FFFF', speed: 1.2, handling: 0.8 },
            parrot: { color: '#ff4757', secondary: '#2ed573', speed: 1.05, handling: 1.2 }
        };
        let currentBirdType = 'eagle';

        const player = {
            x: 0, 
            y: 0.8,
            speed: 0,
            tilt: 0,
            shield: false,
            magnet: false,
            magnetTimer: 0
        };

        let obstacles = [];
        let particles = [];
        const viewDistance = 2000;

        // Input
        const keys = { ArrowLeft: false, ArrowRight: false, " ": false };

        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
        }
        window.addEventListener('resize', resize);
        resize();

        async function initAudio() {
            if(isAudioInit) return;
            await Tone.start();

            // Wind Noise
            const filter = new Tone.AutoFilter({ frequency: 1, baseFrequency: 200, octaves: 2.6 }).toDestination().start();
            noiseSynth = new Tone.NoiseSynth({ volume: -20, noise: { type: "pink" } }).connect(filter);

            // SFX
            coinSynth = new Tone.PolySynth(Tone.Synth, { volume: -10, oscillator: { type: "sine" } }).toDestination();
            powerupSynth = new Tone.Synth({ oscillator: { type: "square" }, envelope: { attack: 0.01, decay: 0.3, sustain: 0, release: 0.1 } }).toDestination();
            crashSynth = new Tone.MembraneSynth({ volume: 0 }).toDestination();
            
            isAudioInit = true;
        }

        // --- Logic ---

        function selectBird(type) {
            currentBirdType = type;
            document.querySelectorAll('.bird-card').forEach(c => c.classList.remove('selected'));
            document.getElementById(`card-${type}`).classList.add('selected');
        }

        function updatePowerupUI() {
            const container = document.getElementById('active-powerups');
            container.innerHTML = '';
            
            if (player.shield) {
                const div = document.createElement('div');
                div.className = 'powerup-badge';
                div.innerHTML = `<span class="dot" style="background:cyan;"></span> Shield Active`;
                div.style.color = "cyan";
                container.appendChild(div);
            }
            if (player.magnet) {
                const div = document.createElement('div');
                div.className = 'powerup-badge';
                div.innerHTML = `<span class="dot" style="background:#a29bfe;"></span> Magnet (${Math.ceil(player.magnetTimer)}s)`;
                div.style.color = "#a29bfe";
                container.appendChild(div);
            }
        }

        function startGame() {
            initAudio();
            if(isAudioInit) noiseSynth.triggerAttack();
            
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-over-screen').classList.add('hidden');
            
            score = 0;
            player.x = 0;
            player.speed = 20;
            player.shield = false;
            player.magnet = false;
            player.magnetTimer = 0;
            updatePowerupUI();
            
            obstacles = [];
            particles = [];
            isPlaying = true;
            isGameOver = false;
            lastTime = performance.now();
            requestAnimationFrame(gameLoop);
        }

        function resetGame() {
            startGame();
        }

        function spawnObstacle() {
            // Spawn rate based on speed
            if (Math.random() < 0.05 + (player.speed / 6000)) {
                const rand = Math.random();
                let type = 'tree';
                
                // Spawn Logic
                if (rand > 0.96) type = 'shield'; 
                else if (rand > 0.92) type = 'magnet';
                else if (rand > 0.80) type = 'drone';
                else if (rand > 0.65) type = 'coin';
                else if (rand > 0.55) type = 'rock';

                const xPos = (Math.random() * 4) - 2;
                
                obstacles.push({
                    x: xPos,
                    y: type === 'drone' ? 1.5 : 0, // Drones fly
                    z: viewDistance,
                    type: type,
                    active: true,
                    oscillator: Math.random() * Math.PI * 2 // For drone movement
                });
            }
        }

        function createExplosion(x, y, z, color, count=10) {
            for(let p=0; p<count; p++) {
                particles.push({
                    x: x, y: y, z: z,
                    vx: (Math.random()-0.5)*3, vy: (Math.random()-0.5)*3,
                    life: 1.0, color: color
                });
            }
        }

        function update(dt) {
            if (!isPlaying) return;

            const birdStats = birds[currentBirdType];
            
            // Speed Physics
            let targetSpeed = 70 * birdStats.speed;
            if (keys[" "]) targetSpeed = 130 * birdStats.speed;
            player.speed += (targetSpeed - player.speed) * dt;
            score += (player.speed * dt) / 10;
            
            if(isAudioInit) noiseSynth.volume.rampTo(-20 + (player.speed/150)*10, 0.1);

            // Steering
            const moveSpeed = 2.2 * dt * birdStats.handling;
            if (keys.ArrowLeft) {
                player.x -= moveSpeed;
                player.tilt = Math.max(player.tilt - 0.1, -0.6);
            } else if (keys.ArrowRight) {
                player.x += moveSpeed;
                player.tilt = Math.min(player.tilt + 0.1, 0.6);
            } else {
                player.tilt *= 0.9;
            }
            player.x = Math.max(-2, Math.min(2, player.x)); // Clamp bounds

            // Powerup Timers
            if (player.magnet) {
                player.magnetTimer -= dt;
                if (player.magnetTimer <= 0) {
                    player.magnet = false;
                    updatePowerupUI();
                } else if (Math.floor(player.magnetTimer) !== Math.floor(player.magnetTimer + dt)) {
                    updatePowerupUI();
                }
            }

            // Obstacle Logic
            for (let i = obstacles.length - 1; i >= 0; i--) {
                let obj = obstacles[i];
                obj.z -= player.speed * 10 * dt;

                // Drone Movement (Side to Side)
                if (obj.type === 'drone') {
                    obj.oscillator += dt * 2;
                    obj.x += Math.sin(obj.oscillator) * dt * 2; // Move side to side
                }

                // Magnet Logic
                if (player.magnet && obj.type === 'coin' && obj.z < 600 && obj.z > -50) {
                    // Pull coin towards player
                    obj.x += (player.x - obj.x) * dt * 5;
                    // Lower height if flying? No, coins are on ground usually
                }

                // Collision Box
                // Z-check: Close enough?
                if (obj.active && obj.z < 50 && obj.z > -50) {
                    const hitWidth = 0.5; // Generous hit box
                    if (Math.abs(obj.x - player.x) < hitWidth) {
                        
                        // Handle Types
                        if (obj.type === 'coin') {
                            score += 500;
                            if(isAudioInit) coinSynth.triggerAttackRelease(["C5", "E5"], "32n");
                            obj.active = false;
                            obstacles.splice(i, 1);
                            createExplosion(obj.x, 0.5, obj.z, '#FFD700', 5);

                        } else if (obj.type === 'shield') {
                            player.shield = true;
                            if(isAudioInit) powerupSynth.triggerAttackRelease("C6", "8n");
                            updatePowerupUI();
                            obj.active = false;
                            obstacles.splice(i, 1);

                        } else if (obj.type === 'magnet') {
                            player.magnet = true;
                            player.magnetTimer = 10; // 10 seconds
                            if(isAudioInit) powerupSynth.triggerAttackRelease("A5", "8n");
                            updatePowerupUI();
                            obj.active = false;
                            obstacles.splice(i, 1);

                        } else {
                            // HAZARDS (Tree, Rock, Drone)
                            if (player.shield) {
                                // Shield Protects
                                player.shield = false;
                                updatePowerupUI();
                                if(isAudioInit) crashSynth.triggerAttackRelease("G2", "8n"); // Thud
                                createExplosion(obj.x, 0.5, obj.z, 'cyan', 15);
                                obj.active = false; // Destroy obstacle
                                obstacles.splice(i, 1);
                            } else {
                                // Game Over
                                isPlaying = false;
                                isGameOver = true;
                                if(isAudioInit) {
                                    noiseSynth.triggerRelease();
                                    crashSynth.triggerAttackRelease("C1", "4n");
                                }
                                document.getElementById('final-score').innerText = Math.floor(score);
                                document.getElementById('game-over-screen').classList.remove('hidden');
                            }
                        }
                    }
                }

                if (obj.z < -100) obstacles.splice(i, 1);
            }

            // Update Particles
            for(let i = particles.length -1; i>=0; i--) {
                let p = particles[i];
                p.x += p.vx * dt;
                p.y += p.vy * dt;
                p.z -= player.speed * 10 * dt;
                p.life -= dt * 2.5;
                if(p.life <= 0) particles.splice(i, 1);
            }

            spawnObstacle();

            // DOM Updates
            document.getElementById('score-val').innerText = Math.floor(score);
            document.getElementById('speed-val').innerText = Math.floor(player.speed);
        }

        // --- Rendering ---

        function project(x, y, z) {
            const fov = 300;
            const cameraHeight = 150;
            const cameraZ = -50;
            if (z <= cameraZ) return null;
            const scale = fov / (z - cameraZ);
            const screenX = (width / 2) + (x * scale * 200);
            const screenY = (height / 2) - ((y * 200) * scale) + (cameraHeight * scale);
            return { x: screenX, y: screenY, s: scale };
        }

        function drawWorld(ctx) {
            // Sky
            const gradient = ctx.createLinearGradient(0, 0, 0, height);
            gradient.addColorStop(0, "#0984e3");
            gradient.addColorStop(0.5, "#74b9ff");
            gradient.addColorStop(1, "#dfe6e9");
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, width, height);

            // Ground
            const horizonY = height / 2;
            const gGrad = ctx.createLinearGradient(0, horizonY, 0, height);
            gGrad.addColorStop(0, "#2d3436");
            gGrad.addColorStop(1, "#636e72");
            ctx.fillStyle = gGrad;
            ctx.fillRect(0, horizonY, width, height/2);

            // Grid
            ctx.strokeStyle = "rgba(255, 255, 255, 0.15)";
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            // Moving Lines
            const offset = (Date.now() / 1000 * player.speed) % 100;
            for (let z = 20; z < viewDistance; z += 80) {
                let pz = z - offset;
                if (pz < 10) pz += 100;
                const scale = 200 / pz;
                const sy = horizonY + (100 * scale);
                if (sy > height || sy < horizonY) continue;
                ctx.moveTo(0, sy);
                ctx.lineTo(width, sy);
            }
            
            // Perspective Lines
            for(let x = -10; x <= 10; x+=2) {
                const bX = (width/2) + (x * width);
                ctx.moveTo(width/2, horizonY);
                ctx.lineTo(bX, height);
            }
            ctx.stroke();
        }

        function drawBird(ctx) {
            const cx = width / 2 + (player.x * 60); 
            const cy = height - 150; 
            const size = 50;

            ctx.save();
            ctx.translate(cx, cy);
            ctx.rotate(player.tilt);

            // Shield Effect
            if (player.shield) {
                ctx.beginPath();
                ctx.arc(0, -size/4, size * 1.5, 0, Math.PI * 2);
                ctx.fillStyle = "rgba(0, 255, 255, 0.3)";
                ctx.fill();
                ctx.strokeStyle = "rgba(0, 255, 255, 0.8)";
                ctx.lineWidth = 2;
                ctx.stroke();
            }

            // Magnet Effect
            if (player.magnet) {
                ctx.beginPath();
                ctx.arc(0, -size/4, size * 1.2, 0, Math.PI * 2);
                ctx.strokeStyle = "rgba(162, 155, 254, 0.6)";
                ctx.setLineDash([5, 5]);
                ctx.lineWidth = 2;
                ctx.stroke();
                ctx.setLineDash([]);
            }

            // Bird Body
            const cMain = birds[currentBirdType].color;
            const cSec = birds[currentBirdType].secondary;

            // Tail
            ctx.fillStyle = cSec;
            ctx.beginPath();
            ctx.moveTo(-20, 0);
            ctx.lineTo(-40, 10);
            ctx.lineTo(-40, -10);
            ctx.fill();

            // Wings (Flapping)
            const flap = Math.sin(Date.now() * 0.015 * player.speed) * 20;
            ctx.fillStyle = cMain;
            // Left Wing
            ctx.beginPath();
            ctx.moveTo(-10, -10);
            ctx.lineTo(-50, -40 - flap);
            ctx.lineTo(-20, 10);
            ctx.fill();
            // Right Wing
            ctx.beginPath();
            ctx.moveTo(10, -10);
            ctx.lineTo(50, -40 - flap);
            ctx.lineTo(20, 10);
            ctx.fill();

            // Body
            ctx.beginPath();
            ctx.ellipse(0, 0, 30, 15, 0, 0, Math.PI*2);
            ctx.fill();

            // Head
            ctx.beginPath();
            ctx.arc(25, -10, 12, 0, Math.PI*2);
            ctx.fill();
            
            // Beak
            ctx.fillStyle = "#f1c40f";
            ctx.beginPath();
            ctx.moveTo(35, -10);
            ctx.lineTo(45, -5);
            ctx.lineTo(35, 0);
            ctx.fill();

            ctx.restore();
        }

        function drawObstacle(ctx, obj) {
            const p = project(obj.x, obj.y, obj.z);
            if (!p) return;
            const size = 100 * p.s;
            
            if (p.y > height + size || p.y < -size) return;

            ctx.save();
            ctx.translate(p.x, p.y);

            if (obj.type === 'tree') {
                ctx.fillStyle = '#2d3436'; // Trunk
                ctx.fillRect(-size/6, -size, size/3, size);
                ctx.fillStyle = '#00b894'; // Leaves
                ctx.beginPath();
                ctx.moveTo(0, -size*1.5);
                ctx.lineTo(size/2, -size/2);
                ctx.lineTo(-size/2, -size/2);
                ctx.fill();
                ctx.beginPath();
                ctx.moveTo(0, -size);
                ctx.lineTo(size/2, 0);
                ctx.lineTo(-size/2, 0);
                ctx.fill();
            } 
            else if (obj.type === 'rock') {
                ctx.fillStyle = '#636e72';
                ctx.beginPath();
                ctx.arc(0, 0, size/3, 0, Math.PI, true);
                ctx.fill();
            }
            else if (obj.type === 'drone') {
                // Moving Drone
                ctx.fillStyle = '#b2bec3';
                ctx.fillRect(-size/2, -size/4, size, size/4); // Body
                
                // Rotors
                const rotorOffset = Math.sin(Date.now() * 0.1) * 5;
                ctx.fillStyle = '#2d3436';
                ctx.fillRect(-size/2 - 10, -size/4 + rotorOffset, 20, 5);
                ctx.fillRect(size/2 - 10, -size/4 - rotorOffset, 20, 5);

                // Eye
                ctx.fillStyle = 'red';
                ctx.beginPath();
                ctx.arc(0, -size/8, size/8, 0, Math.PI*2);
                ctx.fill();
            }
            else if (obj.type === 'coin') {
                ctx.fillStyle = '#ffeaa7';
                ctx.strokeStyle = '#fdcb6e';
                ctx.lineWidth = 3;
                const rot = Math.sin(Date.now()*0.005);
                ctx.beginPath();
                ctx.ellipse(0, -size/3, size/4 * Math.abs(rot), size/4, 0, 0, Math.PI*2);
                ctx.fill();
                ctx.stroke();
            }
            else if (obj.type === 'shield') {
                // Shield Item
                ctx.fillStyle = 'cyan';
                ctx.shadowBlur = 10;
                ctx.shadowColor = 'cyan';
                ctx.beginPath();
                ctx.arc(0, -size/2, size/4, 0, Math.PI*2);
                ctx.fill();
                ctx.shadowBlur = 0;
                ctx.fillStyle = 'white';
                ctx.font = `bold ${size/4}px Arial`;
                ctx.textAlign = 'center';
                ctx.fillText('S', 0, -size/2 + size/10);
            }
            else if (obj.type === 'magnet') {
                // Magnet Item
                ctx.fillStyle = '#a29bfe';
                ctx.shadowBlur = 10;
                ctx.shadowColor = '#a29bfe';
                ctx.beginPath();
                ctx.arc(0, -size/2, size/4, 0, Math.PI*2);
                ctx.fill();
                ctx.shadowBlur = 0;
                ctx.fillStyle = 'white';
                ctx.font = `bold ${size/4}px Arial`;
                ctx.textAlign = 'center';
                ctx.fillText('M', 0, -size/2 + size/10);
            }

            ctx.restore();
        }

        function gameLoop(time) {
            let dt = (time - lastTime) / 1000;
            lastTime = time;
            
            update(dt);
            
            ctx.clearRect(0, 0, width, height);
            drawWorld(ctx);
            
            // Draw particles behind
            particles.forEach(p => {
                const proj = project(p.x, p.y, p.z);
                if(proj) {
                    ctx.globalAlpha = p.life;
                    ctx.fillStyle = p.color;
                    ctx.beginPath();
                    ctx.arc(proj.x, proj.y, 10 * proj.s, 0, Math.PI*2);
                    ctx.fill();
                    ctx.globalAlpha = 1.0;
                }
            });

            // Painter's Algo
            obstacles.sort((a, b) => b.z - a.z);
            obstacles.forEach(obj => drawObstacle(ctx, obj));

            if(!isGameOver) drawBird(ctx);

            if (isPlaying) requestAnimationFrame(gameLoop);
        }
        
        // Input Handling
        window.addEventListener('keydown', e => keys[e.key] = true);
        window.addEventListener('keyup', e => keys[e.key] = false);
        window.addEventListener('touchstart', e => {
            const x = e.touches[0].clientX;
            if(x < width/2) keys.ArrowLeft = true;
            else keys.ArrowRight = true;
        });
        window.addEventListener('touchend', () => { keys.ArrowLeft = false; keys.ArrowRight = false; });

        // Initial Render
        drawWorld(ctx);
        drawBird(ctx);

    </script>
</body>
</html>
